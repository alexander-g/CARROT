<html>
<head>
  <title>DigIT! Wood Anatomy</title>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">

  <link rel="stylesheet" href="/static/thirdparty/semantic.min.css">
  <script src="/static/thirdparty/jquery-3.4.1.min.js"></script>
  <script src="/static/thirdparty/jquery.tmpl.min.js"></script>
  <script src="/static/thirdparty/semantic.min.js"></script>
  
  <script src="/static/script.js"></script>
  <script src="/static/processing.js"></script>
  <script src="/static/settings.js"></script>
  <script src="/static/util.js"></script>
  <script src="/static/download.js"></script>
  <script src="/static/treering_overlays.js"></script>

  <script src="/static/thirdparty/exif-js"></script>
  <script src="/static/thirdparty/jszip.min.js"></script>
  
  


  <script id="filetable-item-template" type="text/x-jQuery-tmpl">
    <tr class="ui title" filename="${filename}">
      <td> 
        <i class="dropdown icon"></i>
        <i class="icons"  style="font-style: normal;">
          <i class="image outline icon" title="File not yet processed"></i>
          <label>${filename}</label>
        </i>
      </td>
    </tr>
    <tr style="display:none">
      <td colspan="5" class="ui content" style="padding-bottom:21px" filename="${filename}">
        
        {{tmpl({filename:filename}) "#filelist-item-content-template"}}

      </td>
    </tr>
  </script>


  <script id="filelist-item-content-template" type="text/x-jQuery-tmpl">
    <div filename="${filename}">
      <div class="ui large images">
          <!-- left image: input -->
          <div class="ui image">
            <div class="ui dimmer treering-dimmer">
              <div class="ui loader"></div>
            </div>
            <img class="ui image input-image" style="margin:0px;" >
            <svg  class="treering-overlay-svg"
                  style="position:absolute; 
                         top:0px; left:0px; 
                         width:100%; height:100%;"
                  viewBox="0 0 1 1">  <!--viewBox will be adjusted in javascript-->
            </svg>
            <div class="ui top right attached label icon" style="border-top-right-radius: 0;">
              <i class="eye slash link icon treerings-toggle-button" 
                 title="Hide/Show Tree Rings" 
                 onclick="on_toggle_treerings(event)"
                 style="display: none;"></i>
              <i class="play circle link blue icon treerings-single-image" 
                 onclick="on_process_treerings(event)" 
                 title="Detect Tree Rings"></i>
            </div>
          </div>

          <!-- right image: segmented result -->
          <div class="ui image">
            <div class="ui dimmer segmented-dimmer">
                  <div class="content">
                    <div class="ui primary button" filename="${filename}"
                          onclick='on_process_image(event)'>
                         Process Image
                    </div>
                  </div>
            </div>
            <img src="/images/${filename}" class="segmented">
            <div class="ui top right attached label icon" style="border-top-right-radius: 0;">
              <i class="play link blue icon process-single-image" onclick="on_process_image(event)"  title="Process Image"></i>
              <i class="ellipsis horizontal link icon has-popup" data-position="right center"></i>
              <div class="ui popup fluid form right-side-image-selection">
                <div class="grouped fields">
                  <div class="field">
                    <div class="ui radio checked checkbox">
                      <input type="radio" name="0" index="0" class="hidden">
                      <label>Prediction</label>
                    </div>
                  </div>
                  <div class="field">
                    <div class="ui radio disabled checkbox">
                      <input type="radio" name="0" index="1" class="hidden">
                      <label style="white-space: nowrap;">Ground Truth</label>
                    </div>
                  </div>
                  <div class="field">
                    <div class="ui radio disabled checkbox">
                      <input type="radio" name="0" index="2" class="hidden">
                      <label>Comparison</label>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
      </div>
    </div>
  </script>
</head>








<body onload="init()">

<div class="ui container menu">

    <div class="ui simple dropdown item">
      <span class="text">Files</span>
      <i class="dropdown icon"></i>
      <div class="ui menu">
        <label for="input_images" class="ui icon item">
          <i class="images outline icon"></i>
          Load Input Images
        </label>
        <input type="file" id="input_images" style="display:none"
              onchange="on_inputfiles_select(event)" accept="image/*" multiple>
        
        <label for="input_folder" class="ui icon item">
          <i class="folder outline icon"></i>
          Load Input Folder
        </label>
        <input type="file" id="input_folder" style="display:none"
              onchange="on_inputfolder_select(this)"  webkitdirectory directory multiple>
        
        <div class="divider"></div>
        <label for="input-groundtruth" class="ui icon item">
          <i class="violet images icon"></i>
          Load Ground Truth Masks
        </label>
        <input type="file" id="input-groundtruth" style="display:none" 
               onclick="this.value=null;" onchange="on_groundtruth_select(event)" 
               accept="image/*" multiple>
        <label for="input-external-predictions" class="ui icon item">
          <i class="grey images icon"></i>
          Load Saved Predictions
        </label>
        <input type="file" id="input-external-predictions" style="display:none" 
                onclick="this.value=null;" onchange="on_external_predictions_select(event)" 
                accept="image/*" multiple>
      </div>
    </div>

    <div class="item">
    <div class="buttons">
    <label class="ui primary button" onclick="process_all()" id="process-all-button">
        <i class="play icon"></i>
        Process All Images
    </label>
    <label class="ui violet button" onclick="on_retrain()" id="retrain-button" style="display:none;">
      <i class="redo alternate icon"></i>
      Retrain
    </label>
    <label class="ui red button" onclick="on_cancel()" id="cancel-button" style="display:none;">
        <i class="x icon"></i>
        Cancel
    </label>
    </div>
    </div>
    

    <div class="ui secondary right menu">
      <div class="item">
        <div class="ui buttons">
        <label class="ui button has-popup" id="download-button" data-position="bottom right">
          <i class="download icon"></i>
        </label>
        <div class="ui popup transition hidden vertical menu" style="padding:0">
          <a class="item" onclick="on_download_statistics()" 
             id="download-processed-button" style="align-self:auto;margin:0px">
             Download Statistics
          </a>
          <a class="item" onclick="on_download_processed()" 
             id="download-processed-button" style="align-self:auto;margin:0px">
             Download Processed Images
          </a>
          <a class="item" onclick="on_download_comparisons()" 
             id="download-comparisons-button" style="align-self:auto;margin:0px">
            Download Comparisons
          </a>
        </div>
        <script>$('#download-button').popup({hoverable:true});</script>

        <label class="ui button" onclick="on_settings()"
              id="settings-button" data-tooltip="Settings" data-position="bottom center">
          <i class="wrench icon"></i>
        </label>
        </div>
      </div>
    </div>
</div>






<div class="ui container">
<table class="ui basic celled table accordion" id="filetable">
  <tbody>
    <tr class="ui">
      <td>No Files Selected</td>
      <td></td>
    </tr>
  </tbody>
</table>
</div>
<script>$('.ui.table.accordion').accordion({duration:0, onOpening:on_accordion_open});</script>
<style>
.ui.table td.active, .ui.table tr.active { background: #fff!important;  }
</style>








<div class="ui tiny modal" id="settings-dialog">
  <i class="close icon"></i>
  <div class="header"> Settings </div>



  <div class="ui form content">
    <!--<h4 class="ui dividing header">Cell Detection</h4>-->
    <div class="field">
      <label>Cell detection</label>
      <div class="ui toggle checkbox" id="settings-cells-enable">
        <label>Enable detection of cells</label>
        <input type="checkbox" tabindex="0" class="hidden">
      </div>
    </div>
    <div class="field" id="settings-cells-field">
      <label>Cell model</label>
      <div class="ui dropdown selection" id="settings-active-cells-model">
        <input type="hidden" name="active-model">
        <i class="dropdown icon"></i>
        <div class="default text">Select a model</div>
        <div class="menu">
          <div class="item" data-value="1">20200527_alnus_vessels</div>
          <div class="item" data-value="0">20200522_conifer</div>
        </div>
      </div>
    </div>

    <div class="ui divider"></div>

    <!--<h4 class="ui dividing header">Tree Ring Detection</h4>-->
    <div class="field">
      <label>Tree ring detection</label>
      <div class="ui toggle checkbox" id="settings-treerings-enable">
        <label>Enable detection of tree rings</label>
        <input type="checkbox" tabindex="0" class="hidden">
      </div>
    </div>
    <div class="field" id="settings-treerings-field">
      <label>Tree ring model</label>
      <div class="ui dropdown selection" id="settings-active-treering-model">
        <input type="hidden" name="active-treering-model">
        <i class="dropdown icon"></i>
        <div class="default text">Select a model</div>
        <div class="menu">
          <div class="item" data-value="1">20200527_alnus_vessels</div>
          <div class="item" data-value="0">20200522_conifer</div>
        </div>
      </div>
    </div>

    <div class="ui divider"></div>

    <div class="field">
      <label>Comparisons</label>
      <div class="ui right labeled input" id="settings-ignore-buffer">
        <input type="number" step="1" min="0" style="width: 5ch;" value="0" id='settings-ignore-buffer-input'>
        <div class="ui basic label"> px </div>
        <label style="padding:10px">Ignore cells within this distance from the border</label>
      </div>
    </div>
  </div>

  <div class="actions">
      <div class="ui negative button">
        Cancel
      </div>
      <div class="ui positive right labeled icon button">
        Save
        <i class="checkmark icon"></i>
      </div>
    </div>
</div>


</body>
</html>
